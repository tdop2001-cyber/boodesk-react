"use strict";(self.webpackChunkboodesk_react=self.webpackChunkboodesk_react||[]).push([[775],{775:(e,o,r)=>{r.d(o,{uploadService:()=>i});const t="https://d20101af9dd64057603c4871abeb1b0c.r2.cloudflarestorage.com",a="boodesk-cdn",n="d58b5663e74d84ecebd28a00c5bafaa1",s="f4ae1bb0dae208bda1f51ccc49ffd7ac050fbb0d6eaaffbd1fc8d5f28ca621ef",c=window.AWS;const i=new class{getS3Client(){if("undefined"===typeof c)throw new Error("AWS SDK n\xe3o est\xe1 carregado. Verifique se o script est\xe1 inclu\xeddo no index.html");return c.config.update({accessKeyId:n,secretAccessKey:s,region:"auto"}),new c.S3({endpoint:t,s3ForcePathStyle:!0,signatureVersion:"v4"})}async uploadFile(e){try{const{file:o,folder:r="",fileName:n,contentType:s}=e;0;const c=o.name.split(".").pop(),i=n||"".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2),".").concat(c),d=r?"".concat(r,"/").concat(i):i;console.log("\ud83d\udd04 Iniciando upload:",{fileName:o.name,fileSize:o.size,fileType:o.type,key:d});const l=this.getS3Client();console.log("\ud83d\udd04 Fazendo upload com AWS SDK...");const u={Bucket:a,Key:d,Body:o,ContentType:s||o.type,Metadata:{originalName:o.name,uploadedBy:"boodesk-app",uploadedAt:(new Date).toISOString()}},m=await new Promise((e,o)=>{l.upload(u,(r,t)=>{r?o(r):e(t)})});console.log("\u2705 Upload funcionou:",m);return{success:!0,url:"".concat(t,"/").concat(a,"/").concat(d),key:d}}catch(o){console.error("\u274c Erro no upload:",{error:o,message:o instanceof Error?o.message:"Erro desconhecido",name:o instanceof Error?o.name:"Unknown",stack:o instanceof Error?o.stack:void 0});let e="Erro desconhecido no upload";return o instanceof Error&&(e=o.message.includes("Access Denied")?"Acesso negado - verifique as permiss\xf5es do token R2":o.message.includes("NetworkError")?"Erro de rede - verifique a conex\xe3o com a internet":o.message.includes("CORS")?"Erro CORS - verifique a configura\xe7\xe3o CORS do bucket":o.message.includes("Failed to fetch")?"Falha na requisi\xe7\xe3o - verifique o endpoint e credenciais":o.message.includes("readableStream.getReader")?"Erro de compatibilidade com navegador - tentando m\xe9todo alternativo":o.message),{success:!1,error:e}}}async uploadMultipleFiles(e){const o=e.map(e=>this.uploadFile(e));return Promise.all(o)}getPublicUrl(e){return"".concat(t,"/").concat(a,"/").concat(e)}async deleteFile(e){try{0,console.log("\ud83d\uddd1\ufe0f Deletando arquivo do R2:",e);const o=this.getS3Client(),r={Bucket:a,Key:e};return await o.deleteObject(r).promise(),console.log("\u2705 Arquivo deletado com sucesso do R2:",e),{success:!0}}catch(o){return console.error("\u274c Erro ao deletar arquivo do R2:",o),{success:!1,error:o instanceof Error?o.message:"Erro desconhecido ao deletar arquivo"}}}async getSignedDownloadUrl(e){return this.getPublicUrl(e)}validateFileType(e,o){return o.includes(e.type)}validateFileSize(e,o){const r=1024*o*1024;return e.size<=r}generateImagePreview(e){return new Promise((o,r)=>{if(!e.type.startsWith("image/"))return void r(new Error("Arquivo n\xe3o \xe9 uma imagem"));const t=new FileReader;t.onload=e=>{var r;o(null===(r=e.target)||void 0===r?void 0:r.result)},t.onerror=r,t.readAsDataURL(e)})}async compressImage(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.8;return new Promise((r,t)=>{if(!e.type.startsWith("image/"))return void r(e);const a=document.createElement("canvas"),n=a.getContext("2d"),s=new Image;s.onload=()=>{a.width=s.width,a.height=s.height,null===n||void 0===n||n.drawImage(s,0,0),a.toBlob(o=>{if(o){const t=new File([o],e.name,{type:e.type,lastModified:Date.now()});r(t)}else t(new Error("Falha na compress\xe3o da imagem"))},e.type,o)},s.onerror=t,s.src=URL.createObjectURL(e)})}async uploadImageWithCompression(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8;try{const t=await this.compressImage(e,r);return this.uploadFile({file:t,folder:o,contentType:e.type})}catch(t){return console.error("Erro no upload com compress\xe3o:",t),{success:!1,error:t instanceof Error?t.message:"Erro no upload com compress\xe3o"}}}}}}]);
//# sourceMappingURL=775.531e7702.chunk.js.map